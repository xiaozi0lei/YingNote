function editorMode(){this.writingHash="writing";this.normalHash="normal";this.isWritingMode=location.hash.indexOf(this.writingHash)>=0;this.toggleA=null}editorMode.prototype.toggleAText=function(isWriting){var self=this;setTimeout(function(){var toggleA=$(".toggle-editor-mode a");var toggleSpan=$(".toggle-editor-mode span");if(isWriting){toggleA.attr("href","#"+self.normalHash);toggleSpan.text(getMsg("normalMode"))}else{toggleA.attr("href","#"+self.writingHash);toggleSpan.text(getMsg("writingMode"))}},0)};editorMode.prototype.isWriting=function(hash){if(!hash){hash=location.hash}return hash.indexOf(this.writingHash)>=0};editorMode.prototype.init=function(){this.$themeLink=$("#themeLink");this.changeMode(this.isWritingMode);var self=this;$(".toggle-editor-mode").click(function(e){e.preventDefault();saveBookmark();var $a=$(this).find("a");var isWriting=self.isWriting($a.attr("href"));self.changeMode(isWriting);if(isWriting){setHash("m",self.writingHash)}else{setHash("m",self.normalHash)}restoreBookmark()})};editorMode.prototype.changeMode=function(isWritingMode){this.toggleAText(isWritingMode);if(isWritingMode){this.writtingMode()}else{this.normalMode()}};editorMode.prototype.resizeEditor=function(){setTimeout(function(){resizeEditor()},10);setTimeout(function(){resizeEditor()},20);setTimeout(function(){resizeEditor()},500)};editorMode.prototype.normalMode=function(){$("#noteItemListWrap, #notesAndSort").show();$("#noteList").unbind("mouseenter").unbind("mouseleave");var theme=UserInfo.Theme||"default";theme+=".css";var $themeLink=$("#themeLink");if(this.$themeLink.attr("href").indexOf("writting-overwrite.css")!=-1){this.$themeLink.attr("href","/css/theme/"+theme)}$("#noteList").width(UserInfo.NoteListWidth);$("#note").css("left",UserInfo.NoteListWidth)};editorMode.prototype.writtingMode=function(){if(this.$themeLink.attr("href").indexOf("writting-overwrite.css")==-1){this.$themeLink.attr("href","/css/theme/writting-overwrite.css")}$("#noteItemListWrap, #notesAndSort").fadeOut();$("#noteList").hover(function(){$("#noteItemListWrap, #notesAndSort").fadeIn()},function(){$("#noteItemListWrap, #notesAndSort").fadeOut()});this.resizeEditor();$("#noteList").width(250);$("#note").css("left",0);Note.toggleWriteable()};editorMode.prototype.getWritingCss=function(){if(this.isWritingMode){return["/css/editor/editor-writting-mode.css"]}return[]};var em=new editorMode;LEA.em=em;var Resize={lineMove:false,mdLineMove:false,target:null,leftNotebook:$("#leftNotebook"),notebookSplitter:$("#notebookSplitter"),noteList:$("#noteList"),noteAndEditor:$("#noteAndEditor"),noteSplitter:$("#noteSplitter"),note:$("#note"),body:$("body"),leftColumn:$("#left-column"),rightColumn:$("#right-column"),mdSplitter:$("#mdSplitter2"),init:function(){var self=this;self.initEvent()},initEvent:function(){var self=this;$(".noteSplit").bind("mousedown",function(event){event.preventDefault();self.lineMove=true;$(this).css("background-color","#ccc");self.target=$(this).attr("id");$("#noteMask").css("z-index",99999)});self.mdSplitter.bind("mousedown",function(event){event.preventDefault();if($(this).hasClass("open")){self.mdLineMove=true}});self.body.bind("mousemove",function(event){if(self.lineMove){event.preventDefault();self.resize3Columns(event)}else if(self.mdLineMove){event.preventDefault();self.resizeMdColumns(event)}});self.body.bind("mouseup",function(event){self.stopResize();$("#noteMask").css("z-index",-1)});var everLeftWidth;$(".layout-toggler-preview").click(function(){var $t=$(this);var $p=self.leftColumn.parent();if($t.hasClass("open")){var totalWidth=$p.width();var minRightWidth=22;var leftWidth=totalWidth-minRightWidth;everLeftWidth=self.leftColumn.width();self.leftColumn.width(leftWidth);self.rightColumn.css("left","auto").width(minRightWidth);$t.removeClass("open");self.rightColumn.find(".layout-resizer").removeClass("open");$(".preview-container").hide()}else{$t.addClass("open");self.rightColumn.find(".layout-resizer").addClass("open");self.leftColumn.width(everLeftWidth);$(".preview-container").show();self.rightColumn.css("left",everLeftWidth).width("auto");if(MD){MD.onResize()}}})},stopResize:function(){var self=this;if(self.lineMove||self.mdLineMove){ajaxGet("/user/updateColumnWidth",{mdEditorWidth:UserInfo.MdEditorWidth,notebookWidth:UserInfo.NotebookWidth,noteListWidth:UserInfo.NoteListWidth},function(){})}self.lineMove=false;self.mdLineMove=false;$(".noteSplit").css("background","none");self.mdSplitter.css("background","none")},set3ColumnsWidth:function(notebookWidth,noteListWidth){var self=this;if(notebookWidth<150||noteListWidth<100){return}var noteWidth=self.body.width()-notebookWidth-noteListWidth;if(noteWidth<400){return}self.leftNotebook.width(notebookWidth);self.notebookSplitter.css("left",notebookWidth);self.noteAndEditor.css("left",notebookWidth);self.noteList.width(noteListWidth);self.noteSplitter.css("left",noteListWidth);self.note.css("left",noteListWidth);UserInfo.NotebookWidth=notebookWidth;UserInfo.NoteListWidth=noteListWidth},resize3Columns:function(event,isFromeIfr){var self=this;if(isFromeIfr){event.clientX+=self.body.width()-self.note.width()}var notebookWidth,noteListWidth;if(self.lineMove){if(self.target=="notebookSplitter"){notebookWidth=event.clientX;noteListWidth=self.noteList.width();self.set3ColumnsWidth(notebookWidth,noteListWidth)}else{notebookWidth=self.leftNotebook.width();noteListWidth=event.clientX-notebookWidth;self.set3ColumnsWidth(notebookWidth,noteListWidth)}resizeEditor()}},resizeMdColumns:function(event){var self=this;if(self.mdLineMove){var mdEditorWidth=event.clientX-self.leftColumn.offset().left;self.setMdColumnWidth(mdEditorWidth)}},setMdColumnWidth:function(mdEditorWidth){var self=this;if(mdEditorWidth>100){UserInfo.MdEditorWidth=mdEditorWidth;log(mdEditorWidth);self.leftColumn.width(mdEditorWidth);self.rightColumn.css("left",mdEditorWidth)}if(MD){MD.onResize()}}};Mobile={noteO:$("#note"),bodyO:$("body"),setMenuO:$("#setMenu"),hashChange:function(){var self=Mobile;var hash=location.hash;if(hash.indexOf("noteId")!=-1){self.toEditor(false);var noteId=hash.substr(8);Note.changeNote(noteId,false,false)}else{self.toNormal(false)}},init:function(){var self=this;self.isMobile()},isMobile:function(){var u=navigator.userAgent;LEA.isMobile=false;LEA.isMobile=/Mobile|Android|iPhone|iPad/i.test(u);LEA.isIpad=/iPad/i.test(u);LEA.isIphone=/iPhone/i.test(u);if(!LEA.isMobile&&$(document).width()<=700){LEA.isMobile=true}return LEA.isMobile},changeNote:function(noteId){var self=this;if(!LEA.isMobile){return true}self.toEditor(true,noteId);return false},toEditor:function(changeHash,noteId){var self=this;self.bodyO.addClass("full-editor");self.noteO.addClass("editor-show")},toNormal:function(changeHash){var self=this;self.bodyO.removeClass("full-editor");self.noteO.removeClass("editor-show")},switchPage:function(){var self=this;if(!LEA.isMobile||LEA.isIpad){return true}if(self.bodyO.hasClass("full-editor")){self.toNormal(true)}else{self.toEditor(true)}return false}};function initSlimScroll(){if(Mobile.isMobile()){return}$("#notebook").slimScroll({height:"100%"});$("#noteItemList").slimScroll({height:"100%"});$("#wmd-panel-preview").slimScroll({height:"100%"});$("#wmd-panel-preview").css("width","100%")}function initEditor(){var mceToobarEverHeight=0;$("#moreBtn").click(function(){saveBookmark();var $editor=$("#editor");if($editor.hasClass("all-tool")){$editor.removeClass("all-tool")}else{$editor.addClass("all-tool")}restoreBookmark()});tinymce.init({inline:true,theme:"leanote",valid_children:"+pre[div|#text|p|span|textarea|i|b|strong]",setup:function(ed){ed.on("keydown",function(e){var num=e.which?e.which:e.keyCode;if(Note.readOnly&&!((e.ctrlKey||e.metaKey)&&num==67)){e.preventDefault();return}Note.saveNote(e)});ed.on("click",function(e){})},convert_urls:true,relative_urls:false,remove_script_host:false,selector:"#editorContent",content_css:["/css/editor/editor.css"],skin:"custom",language:LEA.locale,plugins:["autolink link leaui_image leaui_mind lists charmap hr","paste","searchreplace leanote_nav leanote_code tabfocus","table directionality textcolor"],toolbar1:"formatselect | forecolor backcolor | bold italic underline strikethrough | leaui_image leaui_mind | leanote_code leanote_inline_code | bullist numlist | alignleft aligncenter alignright alignjustify",toolbar2:"outdent indent blockquote | link unlink | table | hr removeformat | subscript superscript |searchreplace | pastetext pasteCopyImage | leanote_ace_pre | fontselect fontsizeselect",menubar:false,toolbar_items_size:"small",statusbar:false,url_converter:false,font_formats:"Arial=arial,helvetica,sans-serif;"+"Arial Black=arial black,avant garde;"+"Times New Roman=times new roman,times;"+"Courier New=courier new,courier;"+"Tahoma=tahoma,arial,helvetica,sans-serif;"+"Verdana=verdana,geneva;"+"宋体=SimSun;"+"新宋体=NSimSun;"+"黑体=SimHei;"+"微软雅黑=Microsoft YaHei",block_formats:"Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Paragraph=p",paste_data_images:true});window.onbeforeunload=function(e){Note.curChangedSaveIt()};$("body").on("keydown",Note.saveNote)}var random=1;function scrollTo(self,tagName,text){var iframe=$("#editorContent");var target=iframe.find(tagName+":contains("+text+")");random++;var navs=$('#leanoteNavContent [data-a="'+tagName+"-"+encodeURI(text)+'"]');var len=navs.size();for(var i=0;i<len;++i){if(navs[i]==self){break}}if(target.size()>=i+1){target=target.eq(i);var top=iframe.scrollTop()-iframe.offset().top+target.offset().top;iframe.animate({scrollTop:top},300);return}}$(function(){$(window).resize(function(){Mobile.isMobile();resizeEditor()});initEditor();$(".folderHeader").click(function(){var body=$(this).next();var p=$(this).parent();if(!body.is(":hidden")){$(".folderNote").removeClass("opened").addClass("closed");p.removeClass("opened").addClass("closed");$(this).find(".fa-angle-down").removeClass("fa-angle-down").addClass("fa-angle-right")}else{$(".folderNote").removeClass("opened").addClass("closed");p.removeClass("closed").addClass("opened");$(this).find(".fa-angle-right").removeClass("fa-angle-right").addClass("fa-angle-down")}});$(".leanoteNav h1").on("click",function(e){var $leanoteNav=$(this).closest(".leanoteNav");if(!$leanoteNav.hasClass("unfolder")){$leanoteNav.addClass("unfolder")}else{$leanoteNav.removeClass("unfolder")}});function openSetInfoDialog(whichTab){showDialogRemote("/user/account",{tab:whichTab})}$("#setInfo").click(function(){openSetInfoDialog(0)});$("#wrongEmail").click(function(){openSetInfoDialog(1)});$("#setAvatarMenu").click(function(){showDialog2("#avatarDialog",{title:"头像设置",postShow:function(){}})});$("#setTheme").click(function(){showDialog2("#setThemeDialog",{title:"主题设置",postShow:function(){if(!UserInfo.Theme){UserInfo.Theme="default"}$("#themeForm input[value='"+UserInfo.Theme+"']").attr("checked",true)}})});$("#themeForm").on("click","input",function(e){var val=$(this).val();$("#themeLink").attr("href","/css/theme/"+val+".css");ajaxPost("/user/updateTheme",{theme:val},function(re){if(reIsOk(re)){UserInfo.Theme=val}})});if(!UserInfo.Verified){}$("#notebook, #newMyNote, #myProfile, #topNav, #notesAndSort","#leanoteNavTrigger").bind("selectstart",function(e){e.preventDefault();return false});function updateLeftIsMin(is){ajaxGet("/user/updateLeftIsMin",{leftIsMin:is})}function minLeft(save){$("#leftNotebook").width(30);$("#notebook").hide();$("#noteAndEditor").css("left",30);$("#notebookSplitter").hide();$("#logo").hide();$("#leftSwitcher").hide();$("#leftSwitcher2").show();$("#leftNotebook .slimScrollDiv").hide();if(save){updateLeftIsMin(true)}}function maxLeft(save){$("#noteAndEditor").css("left",UserInfo.NotebookWidth);$("#leftNotebook").width(UserInfo.NotebookWidth);$("#notebook").show();$("#notebookSplitter").show();$("#leftSwitcher2").hide();$("#logo").show();$("#leftSwitcher").show();$("#leftNotebook .slimScrollDiv").show();if(save){updateLeftIsMin(false)}}$("#leftSwitcher2").on("click",function(){maxLeft(true)});$("#leftSwitcher").click("click",function(){if(Mobile.switchPage()){minLeft(true)}});function getMaxDropdownHeight(obj){var offset=$(obj).offset();var maxHeight=$(document).height()-offset.top;maxHeight-=70;if(maxHeight<0){maxHeight=0}var preHeight=$(obj).find("ul").height();return preHeight<maxHeight?preHeight:maxHeight}$("#notebookMin div.minContainer").click(function(){var target=$(this).attr("target");maxLeft(true);if(target=="#notebookList"){if($("#myNotebooks").hasClass("closed")){$("#myNotebooks .folderHeader").trigger("click")}}else if(target=="#tagNav"){if($("#myTag").hasClass("closed")){$("#myTag .folderHeader").trigger("click")}}else{if($("#myShareNotebooks").hasClass("closed")){$("#myShareNotebooks .folderHeader").trigger("click")}}});UserInfo.NotebookWidth=UserInfo.NotebookWidth||$("#notebook").width();UserInfo.NoteListWidth=UserInfo.NoteListWidth||$("#noteList").width();Resize.init();Resize.set3ColumnsWidth(UserInfo.NotebookWidth,UserInfo.NoteListWidth);Resize.setMdColumnWidth(UserInfo.MdEditorWidth);if(UserInfo.LeftIsMin){minLeft(false)}$("#mainMask").html("");$("#mainMask").hide(100);$(".dropdown").on("shown.bs.dropdown",function(){var $ul=$(this).find("ul")});$("#tipsBtn").click(function(){showDialog2("#tipsDialog")});$("#yourSuggestions").click(function(){showDialog2("#suggestionsDialog")});$("#suggestionBtn").click(function(e){e.preventDefault();var suggestion=$.trim($("#suggestionTextarea").val());if(!suggestion){$("#suggestionMsg").html("请输入您的建议, 谢谢!").show().addClass("alert-warning").removeClass("alert-success");$("#suggestionTextarea").focus();return}$("#suggestionBtn").html("正在处理...").addClass("disabled");$("#suggestionMsg").html("正在处理...");$.post("/suggestion",{suggestion:suggestion},function(ret){$("#suggestionBtn").html("提交").removeClass("disabled");if(ret.Ok){$("#suggestionMsg").html("谢谢反馈, 我们会第一时间处理, 祝您愉快!").addClass("alert-success").removeClass("alert-warning").show()}else{$("#suggestionMsg").html("出错了").show().addClass("alert-warning").removeClass("alert-success")}})});em.init();Mobile.init()});var Pjax={init:function(){var me=this;window.addEventListener("popstate",function(evt){var state=evt.state;if(!state){return}document.title=state.title||"Untitled";log("pop");me.changeNotebookAndNote(state.noteId)},false);if(!history.pushState){$(window).on("hashchange",function(){var noteId=getHash("noteId");if(noteId){me.changeNotebookAndNote(noteId)}})}},changeNotebookAndNote:function(noteId){var note=Note.getNote(noteId);if(!note){return}var isShare=note.Perm!=undefined;var notebookId=note.NotebookId;if(Notebook.curNotebookId==notebookId){Note.changeNoteForPjax(noteId,false);return}if(!isShare){Notebook.changeNotebook(notebookId,function(notes){Note.renderNotes(notes);Note.changeNoteForPjax(noteId,false,true)})}else{Share.changeNotebook(note.UserId,notebookId,function(notes){Note.renderNotes(notes);Note.changeNoteForPjax(noteId,false,true)})}},changeNote:function(noteInfo){var me=this;log("push");var noteId=noteInfo.NoteId;var title=noteInfo.Title;var url="/note/"+noteId;if(location.hash){url+=location.hash}if(history.pushState){var state={url:url,noteId:noteId,title:title};history.pushState(state,title,url);document.title=title||"Untitled"}else{setHash("noteId",noteId)}}};$(function(){Pjax.init()});LeaAce={_aceId:0,_aceEditors:{},_isInit:false,_canAce:false,isAce:true,disableAddHistory:function(){tinymce.activeEditor.undoManager.setCanAdd(false)},resetAddHistory:function(){tinymce.activeEditor.undoManager.setCanAdd(true)},canAce:function(){if(this._isInit){return this._canAce}if(getVendorPrefix()=="webkit"&&!Mobile.isMobile()){this._canAce=true}else{this._canAce=false}this._isInit=true;return this._canAce},canAndIsAce:function(){return this.canAce()&&this.isAce},getAceId:function(){this.aceId++;return"leanote_ace_"+(new Date).getTime()+"_"+this._aceId},initAce:function(id,val,force){var me=this;if(!force&&!me.canAndIsAce()){return}var $pre=$("#"+id);if($pre.length==0){return}var rawCode=$pre.html();try{me.disableAddHistory();var classes=$pre.attr("class")||"";var isHtml=classes.indexOf("brush:html")!=-1;if($pre.attr("style")||!isHtml&&$pre.html().indexOf("style")!=-1){$pre.html($pre.text())}$pre.find(".toggle-raw").remove();var preHtml=$pre.html();$pre.removeClass("ace-to-pre");$pre.attr("contenteditable",false);var aceEditor=ace.edit(id);aceEditor.setTheme("ace/theme/tomorrow");var brush=me.getPreBrush($pre);var b="";if(brush){try{b=brush.split(":")[1]}catch(e){}}b=b||"javascript";aceEditor.session.setMode("ace/mode/"+b);aceEditor.session.setOption("useWorker",false);if(window.devicePixelRatio==2){aceEditor.setFontSize("12px")}else{aceEditor.setFontSize("14px")}aceEditor.getSession().setUseWorker(false);aceEditor.setOption("showInvisibles",false);aceEditor.setShowInvisibles(false);aceEditor.setOption("wrap","free");aceEditor.setShowInvisibles(false);aceEditor.setReadOnly(Note.readOnly);aceEditor.setAutoScrollEditorIntoView(true);aceEditor.setOption("maxLines",1e4);aceEditor.commands.addCommand({name:"undo",bindKey:{win:"Ctrl-z",mac:"Command-z"},exec:function(editor){var undoManager=editor.getSession().getUndoManager();if(undoManager.hasUndo()){undoManager.undo()}else{undoManager.reset();tinymce.activeEditor.undoManager.undo()}}});this._aceEditors[id]=aceEditor;if(val){aceEditor.setValue(val)}else{}me.resetAddHistory();return aceEditor}catch(e){console.error("ace error!!!!");console.error(e);$pre.attr("contenteditable",true);$pre.removeClass("ace-tomorrow ace_editor ace-tm");$pre.html(rawCode);me.resetAddHistory()}},clearIntervalForInitAce:null,initAceFromContent:function(editor){if(!this.canAndIsAce()){var content=$(editor.getBody());content.find("pre").removeClass("ace_editor");return}var me=this;if(this.clearIntervalForInitAce){clearInterval(this.clearIntervalForInitAce)}this.clearIntervalForInitAce=setTimeout(function(){var content=$(editor.getBody());var pres=content.find("pre");for(var i=0;i<pres.length;++i){var pre=pres.eq(i);var aceAndNode=me.isInAce(pre);if(aceAndNode){if(isAceError(aceAndNode[0].getValue())){console.error("之前有些没有destroy掉")}else{break}}setTimeout(function(pre){return function(){pre.find(".toggle-raw").remove();var value=pre.html();log(value);value=value.replace(/ /g,"&nbsp;").replace(/\<br *\/*\>/gi,"\n").replace(/</g,"&lt;").replace(/>/g,"&gt;");pre.html(value);var id=pre.attr("id");if(!id){id=me.getAceId();pre.attr("id",id)}me.initAce(id)}}(pre))}},10)},allToPre:function(editor){if(!this.canAndIsAce()){return}var me=this;if(me.clearIntervalForInitAce){clearInterval(me.clearIntervalForInitAce)}me.clearIntervalForInitAce=setTimeout(function(){var content=$(editor.getBody());var pres=content.find("pre");for(var i=0;i<pres.length;++i){var pre=pres.eq(i);setTimeout(function(pre){return function(){me.aceToPre(pre)}}(pre))}},10)},undo:function(editor){if(!this.canAndIsAce()){return}var me=this;if(this.clearIntervalForInitAce){clearInterval(this.clearIntervalForInitAce)}this.clearIntervalForInitAce=setTimeout(function(){var content=$(editor.getBody());var pres=content.find("pre");for(var i=0;i<pres.length;++i){var pre=pres.eq(i);setTimeout(function(pre){return function(){var value=pre.html();var id=pre.attr("id");var aceEditor=me.getAce(id);if(aceEditor){var value=aceEditor.getValue();aceEditor.destroy();var aceEditor=me.initAce(id,value);aceEditor.selection.clearSelection()}else{value=value.replace(/ /g,"&nbsp;").replace(/\<br *\/*\>/gi,"\n");pre.html(value);var id=pre.attr("id");if(!id){id=me.getAceId();pre.attr("id",id)}me.initAce(id)}}}(pre))}},10)},destroyAceFromContent:function(everContent){if(!this.canAce()){return}var pres=everContent.find("pre");for(var i=0;i<pres.length;++i){var id=pres.eq(i).attr("id");var aceEditorAndPre=this.getAce(id);if(aceEditorAndPre){aceEditorAndPre.destroy();this._aceEditors[id]=null}}},getAce:function(id){if(!this.canAce()){return}return this._aceEditors[id]},setAceReadOnly:function(pre,readOnly){var me=this;if(typeof pre=="object"){var id=pre.attr("id")}else{var id=pre}var ace=me.getAce(id);if(ace){ace.setReadOnly(readOnly)}},nowIsInAce:function(){if(!this.canAce()){return}var node=tinymce.activeEditor.selection.getNode();return this.isInAce(node)},nowIsInPre:function(){var node=tinymce.activeEditor.selection.getNode();return this.isInPre(node)},isInPre:function(node){var $node=$(node);var node=$node.get(0);if(node.nodeName=="PRE"){return true}else{$pre=$node.closest("pre");if($pre.length==0){return false}return true}},isInAce:function(node){if(!this.canAce()){return}var $node=$(node);var node=$node.get(0);if(node.nodeName=="PRE"){var id=$node.attr("id");var aceEditor=this.getAce(id);if(aceEditor){return[aceEditor,$node]}return false}else{$pre=$node.closest("pre");if($pre.length==0){return false}return this.isInAce($pre)}return false},getPreBrush:function(node){var $pre=$(node);var classes=$pre.attr("class");if(!classes){return""}var m=classes.match(/brush:[^ ]*/);var everBrush="";if(m&&m.length>0){everBrush=m[0]}return everBrush},preToAce:function(pre,force){if(!force&&!this.canAce()){return}var $pre=$(pre);var id=this.getAceId();$pre.attr("id",id);var editor=this.initAce(id,"",true);if(editor){editor.focus()}},aceToPre:function(pre,isFocus){var me=this;var $pre=$(pre);var aceEditorAndPre=me.isInAce($pre);if(aceEditorAndPre){var aceEditor=aceEditorAndPre[0];var $pre=aceEditorAndPre[1];var value=aceEditor.getValue();if(isAceError(value)){value=$pre.html()}value=value.replace(/</g,"&lt").replace(/>/g,"&gt");var replacePre=$('<pre class="'+$pre.attr("class")+' ace-to-pre">'+value+"</pre>");$pre.replaceWith(replacePre);aceEditor.destroy();me._aceEditors[$pre.attr("id")]=null;if(isFocus){setTimeout(function(){var tinymceEditor=tinymce.activeEditor;var selection=tinymceEditor.selection;var rng=selection.getRng();rng.selectNode(replacePre.get(0));tinymceEditor.focus();replacePre.trigger("click");replacePre.html(value+" ")},0)}}},handleEvent:function(){if(!this.canAce()){return}var me=this;$("#editorContent").on("mouseenter","pre",function(){var $t=$(this);$raw=$t.find(".toggle-raw");if($raw.length==0){$t.append('<div class="toggle-raw" title="Toggle code with raw html"><input type="checkbox" /></div>')}$input=$t.find(".toggle-raw input");if(LeaAce.isInAce($t)){$input.prop("checked",true)}else{$input.prop("checked",false)}});$("#editorContent").on("mouseleave","pre",function(){var $raw=$(this).find(".toggle-raw");$raw.remove()});$("#editorContent").on("change",".toggle-raw input",function(){var checked=$(this).prop("checked");var $pre=$(this).closest("pre");if(checked){me.preToAce($pre,true)}else{me.aceToPre($pre,true)}})}};function initPage(){$(function(){Notebook.renderNotebooks(notebooks);Share.renderShareNotebooks(sharedUserInfos,shareNotebooks);if(curSharedNoteNotebookId){Share.firstRenderShareNote(curSharedUserId,curSharedNoteNotebookId,curNoteId)}else{Note.setNoteCache(noteContentJson);Note.renderNotes(notes);if(curNoteId){setTimeout(function(){Note.changeNoteForPjax(curNoteId,true,curNotebookId)});if(!curNotebookId){Notebook.selectNotebook($(tt('#notebook [notebookId="?"]',Notebook.allNotebookId)))}}}if(latestNotes.length>0){for(var i=0;i<latestNotes.length;++i){Note.addNoteCache(latestNotes[i])}}Tag.renderTagNav(tagsJson);initSlimScroll();LeaAce.handleEvent()})}